var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,i,n)=>(((t,i,n)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n})(t,"symbol"!=typeof i?i+"":i,n),n));import{P as i,d as n,T as s,a as o,b as r,e as a,c,f as l,g as d,h as u}from"./vendor.dca24cf3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var h={type:i.AUTO,parent:"game",backgroundColor:"#33A5E7",scale:{width:800,height:600,mode:i.Scale.FIT,autoCenter:i.Scale.CENTER_BOTH}};const m=n({x:s.f32,y:s.f32}),g=n({x:s.f32,y:s.f32}),p=n({texture:s.ui8}),f=n({angle:s.f32}),w=n({resources:[s.ui8,3],ID:s.ui8,selectedUnits:[s.ui8,50],enemyPlayerIds:[s.ui8,50]}),y=n({timeBetweenActions:s.ui32,accumulatedTime:s.ui32});var b,k;(k=b||(b={}))[k.debug=0]="debug",k[k.play=1]="play",k[k.paused=2]="paused",k[k.gameOver=3]="gameOver",k[k.won=4]="won";const v=n({timeBetweenActions:s.ui32,accumulatedTime:s.ui32,status:s.ui8,levelName:s.ui8,debug:s.ui8,UNIT_TYPES:s.ui8,map:s.ui8});var x,S;(S=x||(x={}))[S.singleClick=0]="singleClick",S[S.doubleClick=1]="doubleClick";const T=n({direction:s.ui8,mouseX:s.ui8,mouseY:s.ui8,CAMERA_SPEED:s.ui8,DOUBLE_CLICK_TIME:s.ui8,click:s.ui8});var P,E;(E=P||(P={}))[E.None=0]="None",E[E.Left=1]="Left",E[E.Right=2]="Right",E[E.Up=3]="Up",E[E.Down=4]="Down";const A=n({LAYER_ANIMATION:s.ui32,tileheight:s.ui8,tilewidth:s.ui8,height:s.ui8,width:s.ui8}),U=n({timeBetweenActions:s.ui32,accumulatedTime:s.ui32});function C(e,t,n,s){const a={font:"32px Arial",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"};let c,l;function d(e,t){switch(t){case 0:e.tint=11206570;break;case 1:e.tint=16755370;break;case 2:e.tint=11184895;break;case 3:e.tint=16755455;break;default:console.error("Undefined player id "+t)}}!function(){c=n.cameras.main,function(){for(let e=0;e<3;e++){const t=c.width-250+70*e,i=10;n.add.text(t+30,i,"2",a).setScrollFactor(0);const s=n.add.sprite(t,i,"crystal");s.setScrollFactor(0),s.setDisplaySize(32,32),d(s,e)}}();const e=n.input.keyboard.createCursorKeys(),t={camera:n.cameras.main,left:e.left,right:e.right,up:e.up,down:e.down,speed:.5};l=new i.Cameras.Controls.FixedKeyControl(t)}(),function(){const e=o([A])(s)[0],t=n.cameras.add(c.width-100,c.height-100,90,90,!1,"minimap");t.zoom=.0625,t.setBounds(0,0,A.width[e]*A.tilewidth[e],A.height[e]*A.tileheight[e])}();const u=o([w,T,U]);return r((e=>{const t=u(e),i=n.game.loop.delta;l.update(i);for(let n=0;n<t.length;++n){const e=t[n];T.direction[e],T.speed[e]}return e}))}i.Cameras.Scene2D.Camera,i.Cameras.Controls.FixedKeyControl,i.Tilemaps.Tilemap;const I=n({timeBetweenActions:s.ui32,accumulatedTime:s.ui32}),N=n({timeBetweenActions:s.ui32,accumulatedTime:s.ui32}),B=class{constructor(){t(this,"BUILDING_COST",10),t(this,"UNIT_COST",5),t(this,"PLAYER_ID",0)}static typeToName(e){return["rock","paper","scissor"][e]}static flatten(e){let t=[];for(let i=0;i<e.length;i++)t=t.concat(e[i]);return t}static enemyObjects(e,t){let i=[];const n=w.enemyPlayerIds[e];for(let s=0;s<Global.units.length;s++)-1!=n.indexOf(s)&&(i=i.concat(t[s]));return i}static allUnits(){return o([y,g,f,T])}static random(e,t){return Math.floor(Math.random()*(t-e+1)+e)}static randomArray(e){if(e.length>0){return e[this.random(0,e.length-1)]}}static spiral(e){let t=0,i=0,n=0,s=1;for(let o=0;o<e;o++)switch(n){case 0:t++,t==s&&n++;break;case 1:i++,i==s&&n++;break;case 2:t--,-t==s&&n++;break;case 3:i--,-i==s&&(n=0,s++)}return[t,i]}static distance(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static closest(e,t){let i,n;for(let s=0;s<t.length;s++){const o=t[s],r=this.distance(e,o.properties());(!i||r<n)&&(n=r,i=o)}return i}static myUnits(e,t){return o([m,I,N])(t)}static mySelectedUnits(e,t){return o([m,I,N])(t)}static allies(e){let t=[];const i=w.enemyPlayerIds[e];for(let n=0;n<Global.units.length;n++)if(-1==i.indexOf(n)&&n!=e){const e=Global.units[n];t=t.concat(e)}return t}static enemies(e){return B.enemyObjects(e,Global.units)}static tintSprite(e,t){switch(t){case 0:e.tint=11206570;break;case 1:e.tint=16755370;break;case 2:e.tint=11184895;break;case 3:e.tint=16755455;break;default:console.error("Undefined player id "+t)}}static onUnitInArea(e,t,i,n,s,o){void 0===o&&(o=!0);const r=Global.game.time.create(!0),a=new Phaser.Geom.Rectangle(e,t,i,n);r.loop(1e3,(function(){for(let e=0;e<Global.selectedUnits[milliseconds].length;e++){const t=w.selectedUnits[PLAYER_ID][e];if(a.contains(t.properties().x,t.properties().y))return console.log("Unit in area ",o),o&&r.destroy(),void s(t)}})),r.start()}static damage(e,t){let i=2;return 0===t&&1==e||1==t&&2==e||2==t&&0===e?i*=2:(1==t&&0===e||2==t&&1==e||0===t&&2==e)&&(i/=2),i}static textButton(e,t,i,n){const s=Global.game,o=200,r=s.add.button(e-100,t,"button",n);r.width=o,r.height=50;s.add.text(e,t,i,{font:"32px Arial",fill:"#ff0000",boundsAlignH:"center",boundsAlignV:"middle"}).setTextBounds(-100,10,o,50)}static progressBar(e,t,i){const n=new Phaser.Geom.Rectangle(e,t,0,10),s=new Phaser.Geom.Rectangle(e,t,32,10);B.progressRender.push({rect:n,background:s});Global.game.time.events.repeat(i/10,10,(function(){n.width+=3.2,s.x=n.right,s.width=32-n.width}))}static render(){const e=Global.game;B.progressRender.forEach((function(t){t.background.width>.1&&(e.debug.geom(t.rect,"rgba(117,213,255,0.5)"),e.debug.geom(t.background,"rgba(23, 74,151,0.5)"))}))}};let M=B;t(M,"progressRender",[]),t(M,"levelResources"),t(M,"UNIT_TYPES",3);const R=class extends Phaser.Events.EventEmitter{constructor(){super()}static getInstance(){return R.instance}};let D=R;t(D,"instance",new R);class L{constructor(){t(this,"ids")}static toEventName(){return L.name}}class G{constructor(){t(this,"ids")}static toEventName(){return G.name}}function _(e,t,n){const s="single_click",a="double_click",c="drag",l="none",d="place_building";let u,h,g,p,f,y,b=l;function k(e,t,i,n){g.x=e,g.y=t,g.width=i,g.height=n}function v(){const t=[];return console.log("Select rectangle "+g.x+","+g.y+", "+g.width+","+g.height),M.myUnits(f,n).forEach((function(e){D.getInstance().emit(L.toEventName(),this,{ids:t}),i.Geom.Rectangle.Contains(g,m.x[e],m.y[e])&&t.push(Uint8Array.from([e])),D.getInstance().emit(G.toEventName(),{ids:t})})),t.length>0&&(w.selectedUnits[void 0]=t),e.time.addEvent({delay:150,callback:function(){k(0,0,0,0)}}),console.log("selected units ",t),t}function x(){k(t.input.activePointer.worldX-.5,t.input.activePointer.worldY-.5,1,1);const e=v();return e.length>0&&(w.selectedUnits[void 0]=e[0]),e[0]}function S(){e.input.activePointer.rightButtonDown()||b==l&&(u={x:t.input.activePointer.worldX,y:t.input.activePointer.worldY},b=e.time.now-h<300?a:s,h=e.time.now)}function P(){if(b==d||"click_building"==b)p.x=t.input.activePointer.worldX,p.y=t.input.activePointer.worldY;else if(b!=l){Math.abs(u.x-t.input.mousePointer.x)+Math.abs(u.y-t.input.mousePointer.y)>20&&e.time.now-h>100&&(b=c,k(Math.min(t.input.activePointer.worldX,u.x),Math.min(t.input.activePointer.worldY,u.y),Math.abs(t.input.activePointer.worldX-u.x),Math.abs(t.input.activePointer.worldY-u.y)))}}const E=o([T]);return y=e.add.graphics({lineStyle:{width:1,color:4278190131}}),e.input.keyboard.createCursorKeys(),e.input.on("pointerup",(function(){if(e.time.now,e.input.activePointer.rightButtonDown())return t.input.activePointer.worldX,void t.input.activePointer.worldY;switch(b){case s:x();break;case a:x()&&(k(-e.cameras.default.worldView.x,-e.cameras.default.worldView.y,e.cameras.default.width,e.cameras.default.height),k(0,0,0,0));break;case c:v();break;default:console.error("no handled MouseStatus: "+b)}b!=d&&(b=l)})),e.input.on("pointerdown",S),e.input.on("pointermove",P),t.canvas.oncontextmenu=function(e){e.preventDefault()},g=new i.Geom.Rectangle(0,0,0,0),p=e.add.sprite(0,0,"castle-rock"),p.alpha=0,p.width=48,p.height=48,r((t=>(E(t),e.game.loop.delta,y.clear(),y.strokeRectShape(g),t)))}function O(e){const t=o([v]);return D.getInstance().on(G.toEventName(),(e=>{var t;t="Event ["+G.toEventName()+"]: "+e,console.log(t)})),r((i=>{const n=t(i);e.game.loop.delta;for(let e=0;e<n.length;++e)n[e];return i}))}const Y=n({x:s.f32,y:s.f32});var K,X;(X=K||(K={}))[X.TankBlue=0]="TankBlue",X[X.TankGreen=1]="TankGreen",X[X.TankRed=2]="TankRed",X[X.Link=3]="Link";class j extends i.Scene{constructor(){super("game"),t(this,"cursors"),t(this,"world"),t(this,"playerSystem"),t(this,"cpuSystem"),t(this,"movementSystem"),t(this,"spriteSystem"),t(this,"hudSystem"),t(this,"levelSystem"),t(this,"controlSystem"),t(this,"debugSystem")}init(){this.cursors=this.input.keyboard.createCursorKeys()}preload(){var e;this.load.image("tank-blue","assets/tank_blue.png"),this.load.image("tank-green","assets/tank_green.png"),this.load.image("tank-red","assets/tank_red.png"),this.load.image("link","assets/animations/link/stand/001.png"),function(e){const t="assets/tilemaps/cross.json";console.log("Loading map ",t),e.load.tilemapTiledJSON("map",t),e.load.image("tile1","assets/tilesets/tilea4.png"),e.load.image("tiel1a","assets/tilesets/tilea1.png"),e.load.image("tile2","assets/tilesets/tilea2.png"),e.load.image("desert","assets/tilesets/desert.png")}(this),(e=this).load.image("crystal","assets/img/crystal-white.png"),e.load.image("fullscreen","assets/img/fullscreen.png")}create(){const{width:e,height:t}=this.scale;this.world=u();const n=l(this.world);d(this.world,m,n),d(this.world,g,n),d(this.world,Y,n),d(this.world,f,n),d(this.world,p,n),d(this.world,v,n),m.x[n]=200,m.y[n]=300,p.texture[n]=3,d(this.world,w,n),w.ID[n]=0,d(this.world,N,n),d(this.world,I,n);for(let s=0;s<2;++s){const n=l(this.world);d(this.world,m,n),m.x[n]=i.Math.Between(.25*e,.75*e),m.y[n]=i.Math.Between(.25*t,.75*t),d(this.world,g,n),d(this.world,f,n),d(this.world,p,n),p.texture[n]=i.Math.Between(1,2),d(this.world,y,n),y.timeBetweenActions[n]=i.Math.Between(0,500),d(this.world,N,n)}this.levelSystem=function(e,t,i){let n;return o([A]),function(){n=e.make.tilemap({key:"map"});const t=l(i);d(i,A,t),A.tileheight[t]=n.tileHeight,A.tilewidth[t]=n.tileWidth,A.width[t]=n.width,A.height[t]=n.height;const s=n.addTilesetImage("desert","desert");n.createLayer("ground",[s])}(),r((e=>e))}(this,this.game,this.world),this.playerSystem=function(e){const t=o([w,T]);return r((i=>{const n=t(i);for(let t=0;t<n.length;++t){const i=n[t];e&&(e.left.isDown?T.direction[i]=P.Left:e.right.isDown?T.direction[i]=P.Right:e.up.isDown?T.direction[i]=P.Up:e.down.isDown?T.direction[i]=P.Down:T.direction[i]=P.None)}return i}))}(this.cursors),this.cpuSystem=function(e){const t=o([y,g,f,T]);return r((n=>{const s=t(n),o=e.game.loop.delta;for(let e=0;e<s.length;++e){const t=s[e];if(y.accumulatedTime[t]+=o,!(y.accumulatedTime[t]<y.timeBetweenActions[t]))switch(y.accumulatedTime[t]=0,i.Math.Between(0,20)){case 0:T.direction[t]=P.Left;break;case 1:T.direction[t]=P.Right;break;case 2:T.direction[t]=P.Up;break;case 3:T.direction[t]=P.Down;break;default:T.direction[t]=P.None}}return n}))}(this),this.hudSystem=C(this.cursors,this.game,this,this.world),this.movementSystem=function(){const e=o([m,g,f,T]);return r((t=>{const i=e(t);for(let e=0;e<i.length;++e){const t=i[e],n=5;switch(T.direction[t]){case P.None:g.x[t]=0,g.y[t]=0;break;case P.Left:g.x[t]=-n,g.y[t]=0,f.angle[t]=180;break;case P.Right:g.x[t]=n,g.y[t]=0,f.angle[t]=0;break;case P.Up:g.x[t]=0,g.y[t]=-n,f.angle[t]=270;break;case P.Down:g.x[t]=0,g.y[t]=n,f.angle[t]=90}m.x[t]+=g.x[t],m.y[t]+=g.y[t]}return t}))}(),this.spriteSystem=function(e,t){const i=new Map,n=o([m,f,p]),s=a(n),l=c(n);return r((o=>{const r=s(o);for(let n=0;n<r.length;++n){const s=r[n],o=p.texture[s],a=t[o];i.set(s,e.add.sprite(0,0,a))}const a=n(o);for(let e=0;e<a.length;++e){const t=a[e],n=i.get(t);n&&(n.x=m.x[t],n.y=m.y[t],n.angle=f.angle[t])}const c=l(o);for(let e=0;e<c.length;++e){const t=r[e];i.delete(t)}return o}))}(this,["tank-blue","tank-green","tank-red","link"]),this.controlSystem=_(this,this.game,this.world),this.debugSystem=O(this)}update(e,t){this.playerSystem(this.world),this.cpuSystem(this.world),this.hudSystem(this.world),this.movementSystem(this.world),this.spriteSystem(this.world),this.controlSystem(this.world)}}new i.Game(Object.assign(h,{scene:[j]}));
