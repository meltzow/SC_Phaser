var se=Object.defineProperty;var ae=(e,i,t)=>i in e?se(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var p=(e,i,t)=>(ae(e,typeof i!="symbol"?i+"":i,t),t);import{P as I,B as re,d as T,T as a,a as A,b as W,e as le,c as ce,C as J,f as U,g as O,h as de}from"./vendor.47a5dd00.js";const ue=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}};ue();var me={type:I.AUTO,parent:"game",backgroundColor:"#33A5E7",scale:{width:800,height:600,mode:I.Scale.FIT,autoCenter:I.Scale.CENTER_BOTH},plugins:{scene:[{key:"rexBoard",plugin:re,mapping:"rexBoard"}]}};const j=T({resources:[a.ui8,3],ID:a.ui8,enemyPlayerIds:[a.ui8,50]});var Z;(function(e){e[e.debug=0]="debug",e[e.play=1]="play",e[e.paused=2]="paused",e[e.gameOver=3]="gameOver",e[e.won=4]="won"})(Z||(Z={}));const ee=T({timeBetweenActions:a.ui32,accumulatedTime:a.ui32,status:a.ui8,levelName:a.ui8,debug:a.ui8,UNIT_TYPES:a.ui8,map:a.ui8}),he=3,y=T({x:a.ui32,y:a.ui32}),v=T({x:a.f32,y:a.f32}),k=T({angle:a.f32,direction:a.ui8});var P;(function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=3]="Up",e[e.Down=4]="Down"})(P||(P={}));const F=T({value:a.ui8}),Y=T({texture:a.ui8});var q;(function(e){e[e.TankBlue=0]="TankBlue",e[e.TankGreen=1]="TankGreen",e[e.TankRed=2]="TankRed",e[e.Link=3]="Link"})(q||(q={}));const z=T({timeBetweenActions:a.ui32,accumulatedTime:a.ui32,commands:[a.ui8,5]}),D=T({type:a.ui8,targetX:a.f32,targetY:a.f32});var X;(function(e){e[e.NONE=0]="NONE",e[e.GOTO=1]="GOTO",e[e.ATTACK=2]="ATTACK"})(X||(X={}));I.Tilemaps.Tilemap;function ge(e){e.load.atlas("player","assets/img/link-white.png","assets/img/zelda32.json"),e.load.atlas("enemy","assets/img/enemy-white.png","assets/img/enemy.json"),e.load.atlas("enemy2","assets/img/enemy2.png","assets/img/enemy2.json"),e.load.scenePlugin({key:"rexboardplugin",url:"https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rexboardplugin.min.js",sceneKey:"rexBoard"})}function pe(e,i,t,o,n,r){const h=A([y,v,k,F,Y,z]);return(()=>{r.board=n.add.board({grid:{gridType:"quadGrid",x:0,y:0,cellWidth:t.tileWidth,cellHeight:t.tileHeight,type:"orthogonal"},width:t.width,height:t.height})})(),W(l=>{const L=h(l);for(let d=0;d<L.length;++d){const s=L[d],w=k.direction[s],x=F.value[s];switch(w){case P.None:v.x[s]=0,v.y[s]=0;break;case P.Left:v.x[s]=-x,v.y[s]=0,k.angle[s]=180;break;case P.Right:v.x[s]=x,v.y[s]=0,k.angle[s]=0;break;case P.Up:v.x[s]=0,v.y[s]=-x,k.angle[s]=270;break;case P.Down:v.x[s]=0,v.y[s]=x,k.angle[s]=90;break}const M=t.worldToTileX(y.x[s]+v.x[s]);M>0&&M<t.width&&(y.x[s]+=v.x[s]),y.y[s]+=v.y[s];const m=t.worldToTileY(y.y[s]+v.y[s]);m>0&&m<t.height&&(y.y[s]+=v.y[s]);const g=r.spriteMap.get(s);if(g){const u=z.commands[s][0];if(u!=null&&D.type[u]==X.GOTO){const b=r.board.worldXYToTileXY(D.targetX[u],D.targetY[u]);n.add.moveTo(g,{occupiedTest:!0}).moveCloser(b.x,b.y),y.x[s]=g.x,y.y[s]=g.y,D.targetX[u]==g.x&&D.targetY[u]==g.y&&(D.type[u]=X.NONE)}}}return l})}function ye(e){e.load.image("tank-blue","assets/tank_blue.png"),e.load.image("tank-green","assets/tank_green.png"),e.load.image("tank-red","assets/tank_red.png"),e.load.image("link","assets/animations/link/stand/001.png")}function fe(e,i,t,o){const n=A([y,k,Y]),r=le(n),h=ce(n);return W(c=>{const l=r(c);for(let s=0;s<l.length;++s){const w=l[s],x=Y.texture[w],M=i[x],m=e.add.sprite(y.x[w],y.y[w],M);t.set(w,m);const g=o.worldXYToTileXY(y.x[w],y.y[w]);o.addChess(m,g.x,g.y,0),m.rexChess.setBlocker()}const L=n(c);for(let s=0;s<L.length;++s){const w=L[s],x=t.get(w);!x||(x.x=y.x[w],x.y=y.y[w],x.angle=k.angle[w])}const d=h(c);for(let s=0;s<d.length;++s){const w=l[s];t.delete(w)}return c})}function we(e){const i=A([j,k]);return W(t=>{const o=i(t);for(let n=0;n<o.length;++n){const r=o[n];e&&(e.left.isDown?k.direction[r]=P.Left:e.right.isDown?k.direction[r]=P.Right:e.up.isDown?k.direction[r]=P.Up:e.down.isDown?k.direction[r]=P.Down:k.direction[r]=P.None)}return t})}const B=T({LAYER_ANIMATION:a.ui32,tileheight:a.ui8,tilewidth:a.ui8,height:a.ui8,width:a.ui8}),R=T({timeBetweenActions:a.ui32,accumulatedTime:a.ui32,ID:a.ui8,type:a.ui8,playerId:a.ui16,maxLife:a.ui16,life:a.ui16});var V;(function(e){e[e.player=0]="player",e[e.enemies=1]="enemies",e[e.resources=2]="resources",e[e.allies=3]="allies",e[e.buildings=4]="buildings"})(V||(V={}));var te;(function(e){e[e.walking=0]="walking",e[e.idle=1]="idle"})(te||(te={}));const _=T({timeBetweenActions:a.ui32,accumulatedTime:a.ui32,isSelected:a.ui8});I.Cameras.Scene2D.Camera;I.Cameras.Controls.FixedKeyControl;function be(e){e.load.image("crystal","assets/img/crystal-white.png"),e.load.image("fullscreen","assets/img/fullscreen.png")}function Le(e,i,t,o,n,r){const h={font:"32px Arial",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"};let c;const l=new Map;function L(m,g){switch(g){case 0:m.tint=11206570;break;case 1:m.tint=16755370;break;case 2:m.tint=11184895;break;case 3:m.tint=16755455;break;default:console.error("Undefined player id "+g)}}function d(){for(let m=0;m<he;m++){const g=n.width-250+m*70,u=10;t.add.text(g+30,u,"2",h).setScrollFactor(0);const b=t.add.sprite(g,u,"crystal");b.setScrollFactor(0),b.setDisplaySize(32,32),L(b,m)}}function s(){d();const m=t.input.keyboard.createCursorKeys(),g={camera:t.cameras.main,left:m.left,right:m.right,up:m.up,down:m.down,speed:.5,zoomIn:t.input.keyboard.addKey("A"),zoomOut:t.input.keyboard.addKey("Q")};c=new I.Cameras.Controls.FixedKeyControl(g)}function w(){const g=A([B])(o)[0],u=t.cameras.add(n.width-100,n.height-100,90,90,!1,"minimap");u.zoom=.125/2,u.setBounds(0,0,B.width[g]*B.tilewidth[g],B.height[g]*B.tileheight[g])}s(),w();const x=A([_,J(y)]),M=A([J(_)]);return W(m=>{const g=t.game.loop.delta;c.update(g);const u=M(m);for(let f=0;f<u.length;++f){const N=u[f];if(_.isSelected[N]){if(!l.has(N)){const C=r.get(N);if(C){const S=t.add.rectangle(C.getBottomLeft().x,C.getBottomLeft().y,C.width,10);S.setStrokeStyle(1,4279343376),l.set(N,S)}}}else{const C=l.get(N);C&&C.destroy(),l.delete(N)}}const b=x(m);for(let f=0;f<b.length;++f){const N=b[f],C=l.get(N),S=r.get(N);C&&S&&(C.x=S.getBottomLeft().x,C.y=S.getBottomLeft().y,C.width=S.width/(R.maxLife[N]/R.life[N]))}return m})}I.Tilemaps.Tilemap;function ve(e){const i="assets/tilemaps/cross.json";console.log("Loading map ",i),e.load.tilemapTiledJSON("map",i),e.load.image("desert","assets/tilesets/desert.png"),e.load.image("objects","assets/tilesets/objects.png")}function xe(e,i,t,o){A([B]);const n=0;function r(){console.log("Map ",o.map);for(let c=0;c<o.map.height;c++)for(let l=0;l<o.map.width;l++){const L=o.map.getTileAt(l,c,!1,"objects");let d;if(L)switch(L.index-1){case-1:break;case 1:case 7:case 13:d=U(t),O(t,R,d),O(t,y,d),O(t,v,d),O(t,F,d),O(t,k,d),y.x[d]=l*o.map.tileWidth,y.y[d]=c*o.map.tileHeight,R.ID[d]=d,R.playerId[d]=n,R.type[d]=V.player,R.maxLife[d]=10,R.life[d]=10,O(t,Y,d),Y.texture[d]=q.Link,O(t,_,d),O(t,z,d);break;default:console.warn("Found Unexpected "+L.index+" at "+l+"x"+c)}}}function h(){o.map=e.make.tilemap({key:"map"});const c=U(t);O(t,B,c),B.tileheight[c]=o.map.tileHeight,B.tilewidth[c]=o.map.tileWidth,B.width[c]=o.map.width,B.height[c]=o.map.height;const l=o.map.addTilesetImage("desert","desert");o.map.addTilesetImage("objects","objects"),o.layer=o.map.createLayer("ground",[l])}return h(),r(),W(c=>c)}var E;(function(e){e[e.NONE=0]="NONE",e[e.DRAG=1]="DRAG",e[e.SINGLE_CLICK=2]="SINGLE_CLICK",e[e.DOUBLE_CLICK=3]="DOUBLE_CLICK",e[e.CLICK_BUILDING=4]="CLICK_BUILDING",e[e.PLACE_BUILDING=5]="PLACE_BUILDING"})(E||(E={}));var ie;(function(e){e[e.singleClick=0]="singleClick",e[e.doubleClick=1]="doubleClick"})(ie||(ie={}));T({mouseX:a.ui8,mouseY:a.ui8,mouseStatus:a.ui8,CAMERA_SPEED:a.ui8,DOUBLE_CLICK_TIME:a.ui8,click:a.ui8});const H=class extends Phaser.Events.EventEmitter{constructor(){super()}static getInstance(){return H.instance}};let G=H;p(G,"instance",new H);var $;(function(e){e[e.single=0]="single",e[e.double=1]="double"})($||($={}));class K{constructor(i,t,o,n=0){this.button=i,this.x=t,this.y=o,this.clickType=n}}var Q;(function(e){e[e.left=0]="left",e[e.right=1]="right",e[e.middle=2]="middle"})(Q||(Q={}));function Ce(e,i,t){const o=300;let n,r,h,c,l;function L(u,b,f,N){h.x=u,h.y=b,h.width=f,h.height=N}function d(){console.log("Select rectangle "+h.x+","+h.y+", "+h.width+","+h.height),A([y,_,R])(t).forEach(function(f){I.Geom.Rectangle.Contains(h,y.x[f],y.y[f])?_.isSelected[f]=1:_.isSelected[f]=0}),e.time.addEvent({delay:150,callback:function(){L(0,0,0,0)}})}function s(){const u=1;return L(i.input.activePointer.worldX-u/2,i.input.activePointer.worldY-u/2,u,u),d()}function w(){s()&&(L(-e.cameras.default.worldView.x,-e.cameras.default.worldView.y,e.cameras.default.width,e.cameras.default.height),L(0,0,0,0))}function x(){e.input.activePointer.rightButtonDown()||l==E.NONE&&(n={x:i.input.activePointer.worldX,y:i.input.activePointer.worldY},e.time.now-r<o?l=E.DOUBLE_CLICK:l=E.SINGLE_CLICK,r=e.time.now)}function M(){l==E.PLACE_BUILDING||l==E.CLICK_BUILDING||l!=E.NONE&&Math.abs(n.x-i.input.mousePointer.x)+Math.abs(n.y-i.input.mousePointer.y)>20&&e.time.now-r>100&&(l=E.DRAG,L(Math.min(i.input.activePointer.worldX,n.x),Math.min(i.input.activePointer.worldY,n.y),Math.abs(i.input.activePointer.worldX-n.x),Math.abs(i.input.activePointer.worldY-n.y)))}function m(){l=E.NONE,c=e.add.graphics({lineStyle:{width:1,color:4279343376}}),e.input.keyboard.createCursorKeys(),A([j])(t)[0],e.input.on("pointerup",function(){const b=i.input.activePointer.worldX,f=i.input.activePointer.worldY;if(e.time.now-r,e.input.activePointer.rightButtonReleased()){G.getInstance().emit(K.name,new K(Q.right,b,f)),A([_])(t).forEach(C=>{if(_.isSelected[C]==1){const S=U(t);O(t,D,S),D.type[S]=X.GOTO,D.targetX[S]=b,D.targetY[S]=f,z.commands[C][0]=S}});return}switch(l){case E.SINGLE_CLICK:s(),G.getInstance().emit(K.name,new K(Q.left,b,f));break;case E.DOUBLE_CLICK:w(),G.getInstance().emit(K.name,new K(Q.left,b,f,$.double));break;case E.DRAG:d();break;default:console.error("no handled MouseStatus: "+l)}l!=E.PLACE_BUILDING&&(l=E.NONE)}),e.input.on("pointerdown",x),e.input.on("pointermove",M),i.canvas.oncontextmenu=function(b){b.preventDefault()},h=new I.Geom.Rectangle(0,0,0,0)}function g(){c.clear(),c.strokeRectShape(h)}return m(),W(u=>(g(),u))}class ne{constructor(){p(this,"ids",[])}}function Ie(e){function i(o){console.log(o)}const t=A([ee]);return G.getInstance().on(ne.name,o=>{i("Event ["+ne.name+"]: "+o)}),G.getInstance().on(K.name,o=>{i("Event ["+K.name+"]: "+o)}),W(o=>{const n=t(o);e.game.loop.delta;for(let r=0;r<n.length;++r)n[r];return o})}I.Tilemaps.Tilemap;I.Tilemaps.TilemapLayer;class ke extends I.Scene{constructor(){super("game");p(this,"cursors");p(this,"world");p(this,"playerSystem");p(this,"cpuSystem");p(this,"movementSystem");p(this,"spriteSystem");p(this,"hudSystem");p(this,"levelSystem");p(this,"controlSystem");p(this,"debugSystem");p(this,"map");p(this,"groundLayer");p(this,"rexBoard");p(this,"board");p(this,"print");p(this,"cameraController");p(this,"gameContainer");p(this,"eventEmitter");p(this,"spriteMap",new Map);this.gameContainer=document.getElementById("game-container"),this.eventEmitter=new I.Events.EventEmitter}init(){this.cursors=this.input.keyboard.createCursorKeys()}preload(){ye(this),ve(this),be(this),ge(this)}create(){this.scale,this.world=de();const i=U(this.world);O(this.world,ee,i),O(this.world,j,i),j.ID[i]=i;const t={map:this.map,layer:this.groundLayer};this.levelSystem=xe(this,this.game,this.world,t),this.map=t.map,this.groundLayer=t.layer,this.playerSystem=we(this.cursors),this.hudSystem=Le(this.cursors,this.game,this,this.world,this.cameras.main,this.spriteMap);const o={board:this.board,spriteMap:this.spriteMap};this.movementSystem=pe(this.game,this,this.map,this.groundLayer,this.rexBoard,o),this.board=o.board,this.spriteMap=o.spriteMap,this.spriteSystem=fe(this,["tank-blue","tank-green","tank-red","link"],this.spriteMap,this.board),this.controlSystem=Ce(this,this.game,this.world),this.debugSystem=Ie(this)}update(i,t){this.playerSystem(this.world),this.hudSystem(this.world),this.movementSystem(this.world),this.spriteSystem(this.world),this.controlSystem(this.world)}resizeGameContainer(){const i=window.innerWidth/window.devicePixelRatio,t=window.innerHeight/window.devicePixelRatio,o=[{scrW:0,gamW:400},{scrW:600,gamW:450},{scrW:900,gamW:550},{scrW:1200,gamW:750},{scrW:1500,gamW:1e3},{scrW:1800,gamW:1300}];let n=null,r=0,h=0;for(let c=0;c<o.length&&(n=o[c],!(i<n.scrW));c++);r=n.gamW,h=n.gamW*(t/i),this.game.scale.resize(r,h),this.eventEmitter.emit("screenResized")}}const oe=new I.Game(Object.assign(me,{scene:[ke]}));window.addEventListener("load",()=>{window.addEventListener("resize",e=>{for(let i=0;i<oe.scene.scenes.length;i++)oe.scene.scenes[i].resizeGameContainer()})});
