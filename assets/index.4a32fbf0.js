var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,i,n)=>(((t,i,n)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n})(t,"symbol"!=typeof i?i+"":i,n),n));import{P as i,d as n,T as s,a as o,b as r,e as a,c as l,f as c,g as d,h as u}from"./vendor.dca24cf3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var h={type:i.AUTO,parent:"game",backgroundColor:"#33A5E7",scale:{width:800,height:600,mode:i.Scale.FIT,autoCenter:i.Scale.CENTER_BOTH}};const m=n({x:s.f32,y:s.f32}),p=n({x:s.f32,y:s.f32}),g=n({texture:s.ui8}),w=n({angle:s.f32});n({values:[s.f32,3]});const f=n({resources:[s.ui8,1],ID:s.ui8}),y=n({timeBetweenActions:s.ui32,accumulatedTime:s.ui32});var k,b;(b=k||(k={}))[b.singleClick=0]="singleClick",b[b.doubleClick=1]="doubleClick";const v=n({direction:s.ui8,speed:s.ui8,mouseX:s.ui8,mouseY:s.ui8,CAMERA_SPEED:s.ui8,DOUBLE_CLICK_TIME:s.ui8,click:s.ui8});var S,x,T,C;(x=S||(S={}))[x.None=0]="None",x[x.Left=1]="Left",x[x.Right=2]="Right",x[x.Up=3]="Up",x[x.Down=4]="Down",(C=T||(T={}))[C.debug=0]="debug",C[C.play=1]="play",C[C.paused=2]="paused",C[C.gameOver=3]="gameOver",C[C.won=4]="won";const P=n({timeBetweenActions:s.ui32,accumulatedTime:s.ui32,status:s.ui8,levelName:s.ui8,debug:s.ui8,UNIT_TYPES:s.ui8,map:s.ui8});const D=n({LAYER_ANIMATION:s.ui32,tileheight:s.ui8,tilewidth:s.ui8,height:s.ui8,width:s.ui8}),B=n({timeBetweenActions:s.ui32,accumulatedTime:s.ui32});function M(e,t,n,s){const a={font:"32px Arial",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"};let l,c;function d(e,t){switch(t){case 0:e.tint=11206570;break;case 1:e.tint=16755370;break;case 2:e.tint=11184895;break;case 3:e.tint=16755455;break;default:console.error("Undefined player id "+t)}}!function(){l=n.cameras.main,function(){for(let e=0;e<3;e++){const t=l.width-250+70*e,i=10;n.add.text(t+30,i,"2",a).setScrollFactor(0);const s=n.add.sprite(t,i,"crystal");s.setScrollFactor(0),s.setDisplaySize(32,32),d(s,e)}}();const e=n.input.keyboard.createCursorKeys(),t={camera:n.cameras.main,left:e.left,right:e.right,up:e.up,down:e.down,speed:.5};c=new i.Cameras.Controls.FixedKeyControl(t)}(),function(){const e=o([D])(s)[0],t=n.cameras.add(l.width-100,l.height-100,90,90,!1,"minimap");t.zoom=.0625,t.setBounds(0,0,D.width[e]*D.tilewidth[e],D.height[e]*D.tileheight[e])}();const u=o([f,v,B]);return r((e=>{const t=u(e),i=n.game.loop.delta;c.update(i);for(let n=0;n<t.length;++n){const e=t[n];v.direction[e],v.speed[e]}return e}))}function A(e,t,i){const n="single_click",s="double_click",a="drag",l="none",c="place_building";let d,u,h,m,p,g=l;function w(e,t,i,n){h.x=e,h.y=t,h.width=i,h.height=n}function f(){return console.log("Select rectangle "+h.x+","+h.y+", "+h.width+","+h.height),h.width=0,[]}function y(){w(t.input.activePointer.worldX-16,t.input.activePointer.worldY-16,32,32);return f()[0]}function k(){e.input.activePointer.rightButtonDown()||g==l&&(d={x:t.input.activePointer.worldX,y:t.input.activePointer.worldY},g=e.time.now-u<300?s:n,u=e.time.now)}function b(){if(g==c||"click_building"==g)m.x=t.input.activePointer.worldX,m.y=t.input.activePointer.worldY;else if(g!=l){Math.abs(d.x-t.input.mousePointer.x)+Math.abs(d.y-t.input.mousePointer.y)>20&&e.time.now-u>100&&(g=a,w(Math.min(t.input.activePointer.worldX,d.x),Math.min(t.input.activePointer.worldY,d.y),Math.abs(t.input.activePointer.worldX-d.x),Math.abs(t.input.activePointer.worldY-d.y)))}}const S=o([v]);return p=e.add.graphics({lineStyle:{width:2,color:4278190131},fillStyle:{color:43520}}),e.input.keyboard.createCursorKeys(),e.input.on("pointerup",(function(){if(e.time.now,e.input.activePointer.rightButtonDown())return t.input.activePointer.worldX,void t.input.activePointer.worldY;switch(g){case n:case s:y();break;case a:f();break;default:console.error("no handled MouseStatus: "+g)}g!=c&&(g=l)})),e.input.on("pointerdown",k),e.input.on("pointermove",b),t.canvas.oncontextmenu=function(e){e.preventDefault()},h=e.add.rectangle(0,0,0,0),m=e.add.sprite(0,0,"castle-rock"),m.alpha=0,m.width=48,m.height=48,r((t=>(S(t),e.game.loop.delta,p.clear(),p.strokeRectShape(h),t)))}var L,N;i.Cameras.Scene2D.Camera,i.Cameras.Controls.FixedKeyControl,i.Tilemaps.Tilemap,(N=L||(L={}))[N.TankBlue=0]="TankBlue",N[N.TankGreen=1]="TankGreen",N[N.TankRed=2]="TankRed",N[N.Link=3]="Link";class _ extends i.Scene{constructor(){super("game"),t(this,"cursors"),t(this,"world"),t(this,"playerSystem"),t(this,"cpuSystem"),t(this,"movementSystem"),t(this,"spriteSystem"),t(this,"hudSystem"),t(this,"levelSystem"),t(this,"controlSystem")}init(){this.cursors=this.input.keyboard.createCursorKeys()}preload(){var e;this.load.image("tank-blue","assets/tank_blue.png"),this.load.image("tank-green","assets/tank_green.png"),this.load.image("tank-red","assets/tank_red.png"),this.load.image("link","assets/animations/link/stand/001.png"),function(e){const t="assets/tilemaps/cross.json";console.log("Loading map ",t),e.load.tilemapTiledJSON("map",t),e.load.image("tile1","assets/tilesets/tilea4.png"),e.load.image("tiel1a","assets/tilesets/tilea1.png"),e.load.image("tile2","assets/tilesets/tilea2.png"),e.load.image("desert","assets/tilesets/desert.png")}(this),(e=this).load.image("crystal","assets/img/crystal-white.png"),e.load.image("fullscreen","assets/img/fullscreen.png")}create(){const{width:e,height:t}=this.scale;this.world=u();const n=c(this.world);d(this.world,m,n),d(this.world,p,n),d(this.world,w,n),d(this.world,g,n),d(this.world,P,n),m.x[n]=200,m.y[n]=300,g.texture[n]=3;for(let o=0;o<2;++o){const n=c(this.world);d(this.world,m,n),m.x[n]=i.Math.Between(.25*e,.75*e),m.y[n]=i.Math.Between(.25*t,.75*t),d(this.world,p,n),d(this.world,w,n),d(this.world,g,n),g.texture[n]=i.Math.Between(1,2),d(this.world,y,n),y.timeBetweenActions[n]=i.Math.Between(0,500)}const s=c(this.world);d(this.world,f,s),f.ID[s]=0,d(this.world,v,s),v.speed[s]=5,this.levelSystem=function(e,t,i){let n;return o([D]),function(){n=e.make.tilemap({key:"map"});const t=c(i);d(i,D,t),D.tileheight[t]=n.tileHeight,D.tilewidth[t]=n.tileWidth,D.width[t]=n.width,D.height[t]=n.height;const s=n.addTilesetImage("desert","desert");n.createLayer("ground",[s])}(),r((e=>e))}(this,this.game,this.world),this.playerSystem=function(e){const t=o([f,v]);return r((i=>{const n=t(i);for(let t=0;t<n.length;++t){const i=n[t];e&&(e.left.isDown?v.direction[i]=S.Left:e.right.isDown?v.direction[i]=S.Right:e.up.isDown?v.direction[i]=S.Up:e.down.isDown?v.direction[i]=S.Down:v.direction[i]=S.None)}return i}))}(this.cursors),this.cpuSystem=function(e){const t=o([y,p,w,v]);return r((n=>{const s=t(n),o=e.game.loop.delta;for(let e=0;e<s.length;++e){const t=s[e];if(y.accumulatedTime[t]+=o,!(y.accumulatedTime[t]<y.timeBetweenActions[t]))switch(y.accumulatedTime[t]=0,i.Math.Between(0,20)){case 0:v.direction[t]=S.Left;break;case 1:v.direction[t]=S.Right;break;case 2:v.direction[t]=S.Up;break;case 3:v.direction[t]=S.Down;break;default:v.direction[t]=S.None}}return n}))}(this),this.hudSystem=M(this.cursors,this.game,this,this.world),this.movementSystem=function(){const e=o([m,p,w]);return r((t=>{const i=e(t);for(let e=0;e<i.length;++e){const t=i[e],n=v.direction[t],s=v.speed[t];switch(n){case S.None:p.x[t]=0,p.y[t]=0;break;case S.Left:p.x[t]=-s,p.y[t]=0,w.angle[t]=180;break;case S.Right:p.x[t]=s,p.y[t]=0,w.angle[t]=0;break;case S.Up:p.x[t]=0,p.y[t]=-s,w.angle[t]=270;break;case S.Down:p.x[t]=0,p.y[t]=s,w.angle[t]=90}m.x[t]+=p.x[t],m.y[t]+=p.y[t]}return t}))}(),this.spriteSystem=function(e,t){const i=new Map,n=o([m,w,g]),s=a(n),c=l(n);return r((o=>{const r=s(o);for(let n=0;n<r.length;++n){const s=r[n],o=g.texture[s],a=t[o];i.set(s,e.add.sprite(0,0,a))}const a=n(o);for(let e=0;e<a.length;++e){const t=a[e],n=i.get(t);n&&(n.x=m.x[t],n.y=m.y[t],n.angle=w.angle[t])}const l=c(o);for(let e=0;e<l.length;++e){const t=r[e];i.delete(t)}return o}))}(this,["tank-blue","tank-green","tank-red","link"]),this.controlSystem=A(this,this.game)}update(e,t){this.playerSystem(this.world),this.cpuSystem(this.world),this.hudSystem(this.world),this.movementSystem(this.world),this.spriteSystem(this.world),this.controlSystem(this.world)}}new i.Game(Object.assign(h,{scene:[_]}));
