var e=Object.defineProperty,t=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);import{P as s,d as i,T as n,a as o,b as r,e as a,c as l,f as c,g as d,h as u}from"./vendor.dca24cf3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var h={type:s.AUTO,parent:"game",backgroundColor:"#33A5E7",scale:{width:800,height:600,mode:s.Scale.FIT,autoCenter:s.Scale.CENTER_BOTH}};const m=i({x:n.f32,y:n.f32}),g=i({x:n.f32,y:n.f32}),p=i({texture:n.ui8}),w=i({angle:n.f32});i({values:[n.f32,3]});const f=i({mouseX:n.ui8,mouseY:n.ui8,CAMERA_SPEED:n.ui8,DOUBLE_CLICK_TIME:n.ui8,resources:[n.ui8,1]}),y=i({timeBetweenActions:n.ui32,accumulatedTime:n.ui32}),k=i({direction:n.ui8,speed:n.ui8});var b,S,T,x;(S=b||(b={}))[S.None=0]="None",S[S.Left=1]="Left",S[S.Right=2]="Right",S[S.Up=3]="Up",S[S.Down=4]="Down",(x=T||(T={}))[x.debug=0]="debug",x[x.play=1]="play",x[x.paused=2]="paused",x[x.gameOver=3]="gameOver",x[x.won=4]="won";const v=i({timeBetweenActions:n.ui32,accumulatedTime:n.ui32,status:n.ui8,levelName:n.ui8,debug:n.ui8,UNIT_TYPES:n.ui8,map:n.ui8});const A=i({LAYER_ANIMATION:n.ui32,tileheight:n.ui8,tilewidth:n.ui8,height:n.ui8,width:n.ui8}),C=i({timeBetweenActions:n.ui32,accumulatedTime:n.ui32});function L(e,t,i,n){const a={font:"32px Arial",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"};let l,c;function d(e,t){switch(t){case 0:e.tint=11206570;break;case 1:e.tint=16755370;break;case 2:e.tint=11184895;break;case 3:e.tint=16755455;break;default:console.error("Undefined player id "+t)}}!function(){l=i.cameras.main,function(){for(let e=0;e<3;e++){const t=l.width-250+70*e,s=10;i.add.text(t+30,s,"2",a).setScrollFactor(0);const n=i.add.sprite(t,s,"crystal");n.setScrollFactor(0),n.setDisplaySize(32,32),d(n,e)}}();const e=i.input.keyboard.createCursorKeys(),t={camera:i.cameras.main,left:e.left,right:e.right,up:e.up,down:e.down,speed:.5};c=new s.Cameras.Controls.FixedKeyControl(t)}(),function(){const e=o([A])(n)[0],t=i.cameras.add(l.width-100,l.height-100,90,90,!1,"minimap");t.zoom=.0625,t.setBounds(0,0,A.width[e]*A.tilewidth[e],A.height[e]*A.tileheight[e])}();const u=o([f,k,C]);return r((e=>{const t=u(e),s=i.game.loop.delta;c.update(s);for(let i=0;i<t.length;++i){const e=t[i];k.direction[e],k.speed[e]}return e}))}var B,N;s.Cameras.Scene2D.Camera,s.Cameras.Controls.FixedKeyControl,s.Tilemaps.Tilemap,(N=B||(B={}))[N.TankBlue=0]="TankBlue",N[N.TankGreen=1]="TankGreen",N[N.TankRed=2]="TankRed",N[N.Link=3]="Link";class D extends s.Scene{constructor(){super("game"),t(this,"cursors"),t(this,"world"),t(this,"playerSystem"),t(this,"cpuSystem"),t(this,"movementSystem"),t(this,"spriteSystem"),t(this,"hudSystem"),t(this,"levelSystem")}init(){this.cursors=this.input.keyboard.createCursorKeys()}preload(){var e;this.load.image("tank-blue","assets/tank_blue.png"),this.load.image("tank-green","assets/tank_green.png"),this.load.image("tank-red","assets/tank_red.png"),this.load.image("link","assets/animations/link/stand/001.png"),function(e){const t="assets/tilemaps/cross.json";console.log("Loading map ",t),e.load.tilemapTiledJSON("map",t),e.load.image("tile1","assets/tilesets/tilea4.png"),e.load.image("tiel1a","assets/tilesets/tilea1.png"),e.load.image("tile2","assets/tilesets/tilea2.png"),e.load.image("desert","assets/tilesets/desert.png")}(this),(e=this).load.image("crystal","assets/img/crystal-white.png"),e.load.image("fullscreen","assets/img/fullscreen.png")}create(){const{width:e,height:t}=this.scale;this.world=u();const i=c(this.world);d(this.world,m,i),d(this.world,g,i),d(this.world,w,i),d(this.world,p,i),d(this.world,v,i),d(this.world,k,i),m.x[i]=200,m.y[i]=300,p.texture[i]=3,k.speed[i]=10;for(let o=0;o<2;++o){const i=c(this.world);d(this.world,m,i),m.x[i]=s.Math.Between(.25*e,.75*e),m.y[i]=s.Math.Between(.25*t,.75*t),d(this.world,g,i),d(this.world,w,i),d(this.world,p,i),p.texture[i]=s.Math.Between(1,2),d(this.world,y,i),y.timeBetweenActions[i]=s.Math.Between(0,500),d(this.world,k,i),k.speed[i]=10}const n=c(this.world);d(this.world,f,n),d(this.world,k,n),k.speed[n]=5,this.levelSystem=function(e,t,s){let i;return o([A]),function(){i=e.make.tilemap({key:"map"});const t=c(s);d(s,A,t),A.tileheight[t]=i.tileHeight,A.tilewidth[t]=i.tileWidth,A.width[t]=i.width,A.height[t]=i.height;const n=i.addTilesetImage("desert","desert");i.createLayer("ground",[n])}(),r((e=>e))}(this,this.game,this.world),this.playerSystem=function(e){const t=o([f,k]);return r((s=>{const i=t(s);for(let t=0;t<i.length;++t){const s=i[t];e&&(e.left.isDown?k.direction[s]=b.Left:e.right.isDown?k.direction[s]=b.Right:e.up.isDown?k.direction[s]=b.Up:e.down.isDown?k.direction[s]=b.Down:k.direction[s]=b.None)}return s}))}(this.cursors),this.cpuSystem=function(e){const t=o([y,g,w,k]);return r((i=>{const n=t(i),o=e.game.loop.delta;for(let e=0;e<n.length;++e){const t=n[e];if(y.accumulatedTime[t]+=o,!(y.accumulatedTime[t]<y.timeBetweenActions[t]))switch(y.accumulatedTime[t]=0,s.Math.Between(0,20)){case 0:k.direction[t]=b.Left;break;case 1:k.direction[t]=b.Right;break;case 2:k.direction[t]=b.Up;break;case 3:k.direction[t]=b.Down;break;default:k.direction[t]=b.None}}return i}))}(this),this.hudSystem=L(this.cursors,this.game,this,this.world),this.movementSystem=function(){const e=o([m,g,w]);return r((t=>{const s=e(t);for(let e=0;e<s.length;++e){const t=s[e],i=k.direction[t],n=k.speed[t];switch(i){case b.None:g.x[t]=0,g.y[t]=0;break;case b.Left:g.x[t]=-n,g.y[t]=0,w.angle[t]=180;break;case b.Right:g.x[t]=n,g.y[t]=0,w.angle[t]=0;break;case b.Up:g.x[t]=0,g.y[t]=-n,w.angle[t]=270;break;case b.Down:g.x[t]=0,g.y[t]=n,w.angle[t]=90}m.x[t]+=g.x[t],m.y[t]+=g.y[t]}return t}))}(),this.spriteSystem=function(e,t){const s=new Map,i=o([m,w,p]),n=a(i),c=l(i);return r((o=>{const r=n(o);for(let i=0;i<r.length;++i){const n=r[i],o=p.texture[n],a=t[o];s.set(n,e.add.sprite(0,0,a))}const a=i(o);for(let e=0;e<a.length;++e){const t=a[e],i=s.get(t);i&&(i.x=m.x[t],i.y=m.y[t],i.angle=w.angle[t])}const l=c(o);for(let e=0;e<l.length;++e){const t=r[e];s.delete(t)}return o}))}(this,["tank-blue","tank-green","tank-red","link"])}update(e,t){this.playerSystem(this.world),this.cpuSystem(this.world),this.hudSystem(this.world),this.movementSystem(this.world),this.spriteSystem(this.world)}}new s.Game(Object.assign(h,{scene:[D]}));
